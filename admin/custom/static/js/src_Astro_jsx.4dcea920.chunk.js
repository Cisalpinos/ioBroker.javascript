"use strict";(self.webpackChunkiobroker_admin_component_backitup=self.webpackChunkiobroker_admin_component_backitup||[]).push([["src_Astro_jsx"],{62435:(rt,w,i)=>{i.d(w,{A:()=>nt});var C=i(28437),t=i.n(C),M=i(95973),h=i.n(M),O=i(36229),A=i(40467),f=i(58714),a=i(67085),b=i(80076),D=i(15680),F=i(69551),R=i(47497),N=i(14660),P=i(53887),$=i(66382),k=i(50115),H=i(95024),j=i(26376),G=i(24092),z=i(5910),n=i(37449),U=i(90598),J=i(31976),B=i(20275),lt=i(12964),W=i(37024),Z=i(91071),V=i(18249),K=Object.defineProperty,Q=(r,e,s)=>e in r?K(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s,x=(r,e,s)=>(Q(r,typeof e!="symbol"?e+"":e,s),s);function X(r){const e=(0,B.ko)();return r.addMap&&r.addMap(e),null}class Y extends C.Component{constructor(e){super(e),x(this,"onMap",s=>{if(!this.map||this.map!==s){this.map=s;const u=[parseFloat(this.state.latitude!==void 0?this.state.latitude:50)||0,parseFloat(this.state.longitude!==void 0?this.state.longitude:10)||0],l=window.L.icon({iconUrl:W,iconRetinaUrl:V,shadowUrl:Z,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});this.marker=window.L.marker(u,{draggable:!0,title:"Resource location",alt:"Resource Location",riseOnHover:!0,icon:l}).addTo(s).bindPopup("Popup for any custom information.").on({dragend:c=>this.onMarkerDragend(c)})}}),x(this,"onMarkerDragend",s=>{if(this.props.readOnly){this.map.flyTo([this.state.latitude,this.state.longitude]),this.marker.setLatLng([this.state.latitude,this.state.longitude]);return}const u=JSON.parse(JSON.stringify(s.target._latlng));this.setState({latitude:u.lat,longitude:u.lng},()=>this.props.onChange(this.state.latitude,this.state.longitude))}),this.state={zoom:14,latitude:this.props.latitude,longitude:this.props.longitude,width:0,height:0},this.divRef=t().createRef(),this.marker=null}componentDidUpdate(){this.map&&this.marker&&(this.props.latitude!==this.state.latitude||this.props.longitude!==this.state.longitude)&&this.setState({latitude:this.props.latitude,longitude:this.props.longitude},()=>{this.latLongTimer&&clearTimeout(this.latLongTimer),this.latLongTimer=setTimeout(()=>{this.latLongTimer=null,this.map.flyTo([this.state.latitude,this.state.longitude]),this.marker.setLatLng([this.state.latitude,this.state.longitude])},500)}),this.divRef.current&&(this.state.width!==this.divRef.current.clientWidth||this.state.height!==this.divRef.current.clientHeight)&&setTimeout(()=>{this.setState({width:this.divRef.current.clientWidth,height:this.divRef.current.clientHeight})},100)}render(){const e=[parseFloat(this.props.latitude!==void 0?this.props.latitude:50)||0,parseFloat(this.props.longitude!==void 0?this.props.longitude:10)||0],{zoom:s}=this.state;return console.log(this.state.width,this.state.height),t().createElement("div",{style:{width:"100%",height:"100%",minHeight:350},ref:this.divRef},this.state.width&&this.state.height?t().createElement(U.W,{style:{width:"100%",height:"100%",minHeight:350,borderRadius:5},center:e,zoom:s,maxZoom:18,attributionControl:!1,zoomControl:!0,doubleClickZoom:!0,scrollWheelZoom:!0,dragging:!this.props.readOnly,animate:!0,easeLinearity:.35},t().createElement(J.e,{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png"}),t().createElement(X,{addMap:u=>this.onMap(u)})):null)}}const q=Y,ot={};var _=Object.getPrototypeOf,tt=Reflect.get,et=(r,e,s)=>tt(_(r),s,e),T=(r,e,s)=>new Promise((u,l)=>{var c=m=>{try{p(s.next(m))}catch(g){l(g)}},d=m=>{try{p(s.throw(m))}catch(g){l(g)}},p=m=>m.done?u(m.value):Promise.resolve(m.value).then(c,d);p((s=s.apply(r,e)).next())});const st={en:b.A,fr:D.A,ru:F.A,de:R.A,es:N.A,br:P.A,nl:$.A,it:k.A,pt:H.A,pl:j.A,uk:G.A,"zh-cn":z.A},I=["useSystemGPS","latitude","longitude","sunriseEvent","sunriseOffset","sunriseLimitStart","sunriseLimitEnd","sunsetEvent","sunsetOffset","sunsetLimitStart","sunsetLimitEnd"];function E(r){if(!r)return new Date;const e=r.split(":");return new Date(2e3,0,1,parseInt(e[0],10),parseInt(e[1],10))}function S(r){return r?`${r.getHours().toString().padStart(2,"0")}:${r.getMinutes().toString().padStart(2,"0")}`:""}function L(r){const e=r.getHours().toString().padStart(2,"0"),s=r.getMinutes().toString().padStart(2,"0"),u=r.getSeconds().toString().padStart(2,"0");return`${e}:${s}:${u}`}class y extends n.ConfigGeneric{componentDidMount(){return T(this,null,function*(){et(y.prototype,this,"componentDidMount").call(this);const e={};I.forEach(s=>{e[s]=n.ConfigGeneric.getValue(this.props.data,s)}),e.sunsetOffset=e.sunsetOffset||0,e.sunriseOffset=e.sunriseOffset||0,e.sunriseLimitStart=E(e.sunriseLimitStart),e.sunriseLimitEnd=E(e.sunriseLimitEnd),e.sunsetLimitStart=E(e.sunsetLimitStart),e.sunsetLimitEnd=E(e.sunsetLimitEnd),e.useSystemGPS&&(e.latitude=this.props.systemConfig.latitude,e.longitude=this.props.systemConfig.longitude),e.ampm=this.props.systemConfig.dateFormat.includes("/"),this.setState(e,()=>this.onChange())})}renderMap(){return t().createElement(q,{longitude:this.state.longitude,latitude:this.state.latitude,readOnly:!!this.state.useSystemGPS,onChange:(e,s)=>this.setState({latitude:e,longitude:s})})}onChange(e,s){let u;typeof e=="object"?u=e:e!==void 0&&(u={[e]:s}),this.setState(u,()=>{const l={};I.forEach(d=>l[d]=this.state[d]),l.sunriseLimitStart=S(l.sunriseLimitStart),l.sunriseLimitEnd=S(l.sunriseLimitEnd),l.sunsetLimitStart=S(l.sunsetLimitStart),l.sunsetLimitEnd=S(l.sunsetLimitEnd),l.sunsetOffset=parseInt(l.sunsetOffset,10)||0,l.sunriseOffset=parseInt(l.sunriseOffset,10)||0,this.calculateRiseSet(l);const c=JSON.parse(JSON.stringify(this.props.data));I.forEach(d=>c[d]=l[d]),e!==void 0&&this.props.onChange(c)})}calculateRiseSet(e){this.props.alive&&this.lastCalc!==JSON.stringify(e)&&(this.lastCalc=JSON.stringify(e),this.calcTimeout&&clearTimeout(this.calcTimeout),this.calcTimeout=setTimeout(()=>T(this,null,function*(){this.calcTimeout=null;const s=yield this.props.socket.sendTo(`${this.props.adapterName}.${this.props.instance}`,"calcAstro",e);if(!s||s.error){console.error(`Cannot calculate astro times: ${JSON.stringify(s.error)}`);return}const u=L(new Date(s.nextSunrise.date)),l=L(new Date(s.nextSunset.date));this.setState({nextSunrise:u,nextSunset:l,nextSunriseServer:s.nextSunrise.serverTime,nextSunsetServer:s.nextSunset.serverTime})}),300))}renderItem(){const{useSystemGPS:e,latitude:s,longitude:u,sunriseEvent:l,sunriseOffset:c,sunriseLimitStart:d,sunriseLimitEnd:p,sunsetEvent:m,sunsetOffset:g,sunsetLimitStart:at,sunsetLimitEnd:it}=this.state,v=window.innerWidth<800;return t().createElement("div",{style:{width:"100%",display:v?void 0:"flex",gap:10}},t().createElement("div",{style:{width:v?"100%":"calc(50% - 5px)",display:v?"block":"inline-block"}},t().createElement(A.$,{dateAdapter:O.h,adapterLocale:st[n.I18n.getLanguage()]},t().createElement(a.FormControlLabel,{style:{width:"calc(100% - 10px)"},control:t().createElement(a.Checkbox,{checked:!!e,onChange:o=>{o.target.checked?this.onChange({useSystemGPS:!0,latitude:this.props.systemConfig.latitude,longitude:this.props.systemConfig.longitude}):this.onChange({useSystemGPS:!1,latitude:s||this.props.systemConfig.latitude,longitude:u||this.props.systemConfig.longitude})}}),label:n.I18n.t("Use system settings")}),e?null:t().createElement(a.TextField,{variant:"standard",type:"text",style:{width:150,marginRight:10},label:n.I18n.t("Latitude \xB0"),value:(s||"").toString(),onChange:o=>this.onChange("latitude",o.target.value)}),e?null:t().createElement(a.TextField,{variant:"standard",style:{width:150},type:"text",label:n.I18n.t("Longitude \xB0"),value:(u||"").toString(),onChange:o=>this.onChange("longitude",o.target.value)}),e?null:t().createElement("div",{style:{width:"calc(100% - 10px)"}},n.I18n.t("Help")),t().createElement("h4",{style:{width:"calc(100% - 10px)",marginTop:20,backgroundColor:this.props.themeType==="dark"?"#333":"#ccc",color:this.props.themeType==="dark"?"#FFF":"#000",padding:"2px 8px",borderRadius:3}},n.I18n.t("Day time settings")),t().createElement("div",{style:{width:"calc(100% - 10px)",display:"flex",gap:8}},t().createElement(a.FormControl,{variant:"standard",style:{width:250}},t().createElement(a.InputLabel,{shrink:!0},n.I18n.t("Time event")),t().createElement(a.Select,{variant:"standard",value:l||"_",onChange:o=>this.onChange("sunriseEvent",o.target.value==="_"?"":o.target.value)},t().createElement(a.MenuItem,{value:"_"},n.I18n.t("none")),t().createElement(a.MenuItem,{value:"nightEnd"},n.I18n.t("sch_astro_nightEnd")),t().createElement(a.MenuItem,{value:"nauticalDawn"},n.I18n.t("sch_astro_nauticalDawn")),t().createElement(a.MenuItem,{value:"dawn"},n.I18n.t("sch_astro_dawn")),t().createElement(a.MenuItem,{value:"sunrise"},n.I18n.t("sch_astro_sunrise")),t().createElement(a.MenuItem,{value:"sunriseEnd"},n.I18n.t("sch_astro_sunriseEnd")),t().createElement(a.MenuItem,{value:"goldenHourEnd"},n.I18n.t("sch_astro_goldenHourEnd"))),t().createElement(a.FormHelperText,null,n.I18n.t("Used as start of the daytime"))),t().createElement(a.TextField,{style:{width:80},variant:"standard",disabled:!this.state.sunriseEvent,label:n.I18n.t("Offset"),value:c||0,helperText:n.I18n.t("in minutes"),onChange:o=>this.onChange("sunriseOffset",o.target.value)}),t().createElement(a.FormControl,{variant:"standard",style:{width:150}},t().createElement(a.InputLabel,{shrink:!0},n.I18n.t("But not earlier")),t().createElement(f.A,{className:`astroToolbarTime ${this.props.themeType}`,disabled:!this.state.sunriseEvent,ampm:!!this.state.ampm,views:["hours","minutes"],value:d||new Date(2e3,0,1,0,0),onChange:o=>this.onChange("sunriseLimitStart",new Date(o))})),t().createElement(a.FormControl,{variant:"standard",style:{width:150}},t().createElement(a.InputLabel,{shrink:!0},n.I18n.t("And not later")),t().createElement(f.A,{className:`astroToolbarTime ${this.props.themeType}`,disabled:!this.state.sunriseEvent,ampm:!!this.state.ampm,views:["hours","minutes"],value:p||new Date(2e3,0,1,0,0),onChange:o=>this.onChange("sunriseLimitEnd",new Date(o))}))),this.props.alive?t().createElement("div",{style:{marginTop:20}},t().createElement("span",{style:{marginRight:8}},n.I18n.t("Next sunrise")),t().createElement("span",null,this.state.nextSunriseServer,this.state.nextSunrise!==this.state.nextSunriseServer?` ${n.I18n.t("Local time")}: ${this.state.nextSunrise}`:"")):null,t().createElement("div",{style:{width:"calc(100% - 10px)",display:"flex",gap:8,paddingTop:30}},t().createElement(a.FormControl,{variant:"standard",style:{width:250}},t().createElement(a.InputLabel,{shrink:!0},n.I18n.t("Time event")),t().createElement(a.Select,{variant:"standard",value:m||"_",onChange:o=>this.onChange("sunsetEvent",o.target.value==="_"?"":o.target.value)},t().createElement(a.MenuItem,{value:"_"},n.I18n.t("none")),t().createElement(a.MenuItem,{value:"goldenHour"},n.I18n.t("sch_astro_goldenHour")),t().createElement(a.MenuItem,{value:"sunsetStart"},n.I18n.t("sch_astro_sunsetStart")),t().createElement(a.MenuItem,{value:"sunset"},n.I18n.t("sch_astro_sunset")),t().createElement(a.MenuItem,{value:"dusk"},n.I18n.t("sch_astro_dusk")),t().createElement(a.MenuItem,{value:"nauticalDusk"},n.I18n.t("sch_astro_nauticalDusk")),t().createElement(a.MenuItem,{value:"night"},n.I18n.t("sch_astro_night"))),t().createElement(a.FormHelperText,null,n.I18n.t("Used as end of the daytime"))),t().createElement(a.TextField,{style:{width:80},variant:"standard",disabled:!this.state.sunsetEvent,label:n.I18n.t("Offset"),value:g||0,helperText:n.I18n.t("in minutes"),onChange:o=>this.onChange("sunsetOffset",o.target.value)}),t().createElement(a.FormControl,{variant:"standard",style:{width:150}},t().createElement(a.InputLabel,{shrink:!0},n.I18n.t("But not earlier")),t().createElement(f.A,{className:`astroToolbarTime ${this.props.themeType}`,disabled:!this.state.sunsetEvent,ampm:!!this.state.ampm,views:["hours","minutes"],value:at||new Date(2e3,0,1,0,0),onChange:o=>this.onChange("sunsetLimitStart",new Date(o))})),t().createElement(a.FormControl,{variant:"standard",style:{width:150}},t().createElement(a.InputLabel,{shrink:!0},n.I18n.t("And not later")),t().createElement(f.A,{className:`astroToolbarTime ${this.props.themeType}`,disabled:!this.state.sunsetEvent,ampm:!!this.state.ampm,views:["hours","minutes"],value:it||new Date(2e3,0,1,0,0),onChange:o=>this.onChange("sunsetLimitEnd",new Date(o))}))),this.props.alive?t().createElement("div",{style:{marginTop:20}},t().createElement("span",{style:{marginRight:8}},n.I18n.t("Next sunset")),t().createElement("span",null,this.state.nextSunsetServer,this.state.nextSunset!==this.state.nextSunsetServer?` ${n.I18n.t("Local time")}: ${this.state.nextSunset}`:"")):null)),t().createElement("div",{style:{width:v?"100%":"calc(50% - 5px)",display:v?"block":"inline-block",minHeight:350}},this.renderMap()))}}y.propTypes={socket:h().object.isRequired,themeType:h().string,themeName:h().string,style:h().object,className:h().string,data:h().object.isRequired,attr:h().string,schema:h().object,onError:h().func,onChange:h().func};const nt=y}}]);

//# sourceMappingURL=src_Astro_jsx.4dcea920.chunk.js.map